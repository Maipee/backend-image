var express = require('express');
var df = require('dateformat');
var passport = require('passport');
var router = express.Router();
var mysql = require('mysql');
var cfg = require('config');
var sqlhelper = require('mysqlhelper2');


//
router.get("/order/list.html", function (req,resp) {
	
	var sql='select * from orders';
	sqlhelper.pool.query(sql,function(err,rows,fields){
		if(err){
			console.log('Il y a une erreur'+err);	
			}
			else{
				resp.render("admin/orders.html.twig",{"listorders":rows});
				}		
	});	
});

//POST

router.post("/order/list.html", function (req,resp) {
	var datarange = req.body.reservation;
	dates=datarange.split(' ');	
	var datedebut = dates[0];
	var datefin = dates[2];
	
	
	var listorders= [];

	
	sqlhelper.pool.query("SELECT * FROM orders WHERE statusdate BETWEEN STR_TO_DATE(?, '%m/%d/%Y') AND STR_TO_DATE(?, '%m/%d/%Y') ",[datedebut,datefin], function (err, rows, fields){
		if(err){
			console.log('Il y a une erreur'+err);	
			}
			else{
				listorders=rows;
				resp.render("admin/orders.html.twig",{"listorders":listorders});
				}	
	});
});








//exportation du module
module.exports = router;
