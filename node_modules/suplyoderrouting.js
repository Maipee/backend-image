var express = require('express');
var router = express.Router();
var sqlhelper = require('mysqlhelper2');
var cfg = require('config');

///////////////////////route "/admin/orders/list" ////////////////////////////////////////////////
router.get("/supplyuorder/list.html", function (req, resp) {
    sqlhelper.pool.query("SELECT * FROM `stock` WHERE `deleted`=0", function (err, rows, fields) {
        //on initialise un tableau dont le nom de la variable est egal à liste_produits, ainsi meme si on ne recupere rien à l'interieur a cause d'une erreur ou qu'il y ai rien dans la bdd
        //La page "/product/list.html" s'affichera toujours
        var liste_commandes={};
        //function qui renvoie une erreur si il y a un probleme
        // on verifie dans la console le valeur de err pour voir si il y a une erreur
        //console.log("err :" + err);
        //si il y a une erreur donc si la valeur err est differente de null
        if (err != null) {
            //on enregistre le message d'erreur'
            //message = "Il y a eu une erreur dans la query";
            //on log pour voir le mesage si il passe
            //console.log(message + ' ----- ' + err);
        }
        else {
            //sinon il n'y a pas d'erreur donc on ajoute la nouvelle valeur au message
            //message = "La recuperation des données c'est bien passé ";
            //on log pour voir le mesage si il passe
            //console.log('message bien reussi avec le message : ' + message);
            //console.log('Tous les produits: '+JSON.stringify(rows));
            liste_commandes = rows;
            //si le user enregistré en session est different de nul (loggé)
                if (typeof req.user !== 'undefined') {
                    //alors je renvoie le twig avec un tablo qui recupere les elements de username
                    resp.render("admin/tables_supplyorder.html.twig", { "username": req.user.username, "orders": liste_commandes});
                }
                //sinon je renvoie le user a la page login pour authentification
                else {
                    resp.redirect("/login.html");
                }
            }  
    });
});










//exportation du module fin de admin 
module.exports = router;